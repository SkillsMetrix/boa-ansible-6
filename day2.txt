from fastapi import FastAPI,status,HTTPException
from random import randrange
from .import schemas

app= FastAPI()
user_data=[{"id":1,"uname":"admin","email":"admin@mail.com"}]

def findById(id):
    for i,p in enumerate(user_data):
        if p['id'] == id:
            print(i,p)
            return p



@app.get('/loadusers')
def loadusers():
    return {'message':user_data}

@app.get('/loaduser/{id}')
def loadUserById(id:int):
    data=findById(id)
    if data == None:
        raise HTTPException(
            status_code=status.HTTP_404_NOT_FOUND,detail= "OOPS, user not found"
        )
    return {'user found ': data}


@app.post('/create', status_code=status.HTTP_201_CREATED)
def addUser(payload: schemas.User):
    postdata= payload.model_dump()
    postdata['id']=randrange(0,1000)
    user_data.append(postdata)
    return {'userdata':postdata}

@app.get('/register')
def register():
    return {'message':'welcome to register'}
